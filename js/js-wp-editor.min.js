/*
 *	JavaScript Wordpress editor
 *	Author: 		Ante Primorac
 *	Author URI: 	http://anteprimorac.from.hr
 *	Version: 		1.0
 *	License:
 *		Copyright (c) 2013 Ante Primorac
 *		Permission is hereby granted, free of charge, to any person obtaining a copy
 *		of this software and associated documentation files (the "Software"), to deal
 *		in the Software without restriction, including without limitation the rights
 *		to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *		copies of the Software, and to permit persons to whom the Software is
 *		furnished to do so, subject to the following conditions:
 *
 *		The above copyright notice and this permission notice shall be included in
 *		all copies or substantial portions of the Software.
 *
 *		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *		IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *		FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 *		AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *		LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *		OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *		THE SOFTWARE.
 *	Usage:
 *		server side(WP):
 *			js_wp_editor( $settings );
 *		client side(jQuery):
 *			$('textarea').wp_editor( options );
 */

;(function(a,q){a.fn.wp_editor=function(b){if(!a(this).is("textarea")||"undefined"==typeof tinyMCEPreInit||"undefined"==typeof QTags)return this;var f={wp_root:location.origin,mode:"html",mceInit:{mode:"exact",width:"100%",theme:"advanced",skin:"wp_theme",language:"en",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:!0,theme_advanced_resize_horizontal:!1,dialog_type:"modal",formats:{alignleft:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"left"},deep:!1,remove:"none"},{selector:"img,table",classes:["alignleft"],deep:!1,remove:"none"}],aligncenter:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"center"},deep:!1,remove:"none"},{selector:"img,table",classes:["aligncenter"],deep:!1,remove:"none"}],alignright:[{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li",styles:{textAlign:"right"},deep:!1,remove:"none"},{selector:"img,table",classes:["alignright"],deep:!1,remove:"none"}],strikethrough:{inline:"del",deep:!0,split:!0}},relative_urls:!1,remove_script_host:!1,convert_urls:!1,remove_linebreaks:!0,gecko_spellcheck:!0,fix_list_elements:!0,keep_styles:!1,entities:"38,amp,60,lt,62,gt",accessibility_focus:!0,media_strict:!1,paste_remove_styles:!0,paste_remove_spans:!0,paste_strip_class_attributes:"all",paste_text_use_dialog:!0,webkit_fake_resize:!1,preview_styles:"font-family font-weight text-decoration text-transform",schema:"html5",wpeditimage_disable_captions:!1,wp_fullscreen_content_css:tinyMCEPreInit.base+"/plugins/wpfullscreen/css/wp-fullscreen.css",plugins:"inlinepopups,tabfocus,paste,media,fullscreen,wordpress,wpeditimage,wpgallery,wplink,wpdialogs,wpfullscreen",content_css:"//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&subset=latin%2Clatin-ext,ap[wp_root]/wp-content/themes/twentythirteen/css/editor-style.css,ap[wp_root]/wp-content/themes/twentythirteen/fonts/genericons.css",elements:"ap[id]",wpautop:!0,apply_source_formatting:!1,theme_advanced_buttons1:"bold,italic,strikethrough,bullist,numlist,blockquote,justifyleft,justifycenter,justifyright,link,unlink,wp_more,spellchecker,fullscreen,wp_adv",theme_advanced_buttons2:"formatselect,underline,justifyfull,forecolor,pastetext,pasteword,removeformat,charmap,outdent,indent,undo,redo,wp_help",theme_advanced_buttons3:"",theme_advanced_buttons4:"",tabfocus_elements:":prev,:next",body_class:"ap[id] post-type-page post-status-auto-draft",theme_advanced_resizing_use_cookie:!0}},k=RegExp("ap\\[id\\]","g"),h=RegExp("ap\\[wp\\_root\\]","g");tinyMCEPreInit.mceInit["ap[id]"]&&(f.mceInit=tinyMCEPreInit.mceInit["ap[id]"]);b=a.extend(!0,f,b);a.each(b.mceInit,function(c,d){"string"==a.type(d)&&(b.mceInit[c]=d.replace(h,b.wp_root))});return this.each(function(){if(a(this).is("textarea")){console.dir(b);var c=a(this).attr("id");b.mceInit.elements=b.mceInit.elements.replace(k,c);b.mceInit.body_class=b.mceInit.body_class.replace(k,c);b.mode="tmce"==b.mode?"tmce":"html";tinyMCEPreInit.mceInit[c]=b.mceInit;a(this).addClass("wp-editor-area").show();var d=this;if(a(this).closest(".wp-editor-wrap").length){var e=a(this).closest(".wp-editor-wrap").parent();a(this).closest(".wp-editor-wrap").before(a(this).clone());a(this).closest(".wp-editor-wrap").remove();d=e.find('textarea[id="'+c+'"]')}var e=a('<div id="wp-'+c+'-wrap" class="wp-core-ui wp-editor-wrap '+b.mode+'-active" />'),g=a('<div id="wp-'+c+'-editor-tools" class="wp-editor-tools hide-if-no-js" />'),f=a('<a id="'+c+'-html" class="wp-switch-editor switch-html" onclick="switchEditors.switchto(this);">Text</a>'),h=a('<a id="'+c+'-tmce" class="wp-switch-editor switch-tmce" onclick="switchEditors.switchto(this);">Visual</a>'),l=a('<div id="wp-'+c+'-media-buttons" class="wp-media-buttons" />'),p=a('<a href="#" id="insert-media-button" class="button insert-media add_media" data-editor="'+c+'" title="Add Media"><span class="wp-media-buttons-icon"></span> Add Media</a>'),m=a('<div id="wp-'+c+'-editor-container" class="wp-editor-container" />'),n=Object.prototype.hasOwnProperty.call(tinyMCEPreInit.mceInit[c],"content_css")?tinyMCEPreInit.mceInit[c].content_css.split(","):!1;p.appendTo(l);f.appendTo(g);h.appendTo(g);l.appendTo(g);g.appendTo(e);m.appendTo(e);m.append(a(d).clone());!1!=n&&a.each(n,function(){a(d).before('<link rel="stylesheet" type="text/css" href="'+this+'">')});a(d).before(e);a(d).remove();new QTags(c);QTags._buttonsInit();switchEditors.go(c,b.mode);a(e).on("click",".insert-media",function(c){var b=a(this),d=b.data("editor"),e={frame:"post",state:"insert",title:wp.media.view.l10n.addMedia,multiple:!0};c.preventDefault();b.blur();b.hasClass("gallery")&&(e.state="gallery",e.title=wp.media.view.l10n.createGalleryTitle);wp.media.editor.open(d,e)})}})}})(jQuery,window);